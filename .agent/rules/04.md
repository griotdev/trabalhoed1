---
trigger: always_on
---

# Lógica do Jogo: Bocha Geométrica

## Fluxo das Peças
1. [cite_start]**Chão:** As peças começam aqui, ordenadas pela criação no `.geo`[cite: 367].
2. **Carregador (Fila/Pilha):** O comando `lc` remove do chão e coloca no carregador.
3. **Disparador:** Recebe carregadores via `atch`. Possui posição de disparo, carga esquerda e carga direita.
4. **Arena:** Após o `dsp`, a peça vai para a arena.
5. **Pós-Processamento:** O comando `calc` avalia as peças na arena.

## Lógica do Comando `shft` (Shift)
[cite_start]Baseado na explicação detalhada da dúvida[cite: 282, 302]:
* **Objetivo:** Preparar munição na posição de disparo.
* **Comando:** `shft id_disp D n` (onde D é a direção da **origem** da munição: `e`=esquerda, `d`=direita).
* **Funcionamento (exemplo `shft ... d n`):**
    * Repete `n` vezes o seguinte ciclo:
        1. Se há algo na posição de disparo, move para o topo da **carga oposta** (esquerda).
        2. Retira um elemento da **carga solicitada** (direita).
        3. Coloca este elemento na posição de disparo.

## Lógica de Colisão e Pontuação (`calc`)
As formas na arena são processadas na ordem de lançamento. [cite_start]Compara-se o elemento $I$ (antigo) com $J$ (recente)[cite: 326].

### Cenário 1: Sem Sobreposição
* [cite_start]Ambos voltam para o chão (na mesma ordem relativa de lançamento)[cite: 332].

### Cenário 2: Com Sobreposição (Intersecção)
A ação depende da área dos elementos.

1. **Destruição ($Area(I) < Area(J)$):**
   * [cite_start]$I$ é "esmagado" (destruído/removido do jogo)[cite: 328].
   * $J$ volta para o chão.
   * [cite_start]**Pontuação:** Soma-se a área de $I$ ao total de pontos[cite: 333].

2. **Modificação e Clonagem ($Area(I) \ge Area(J)$):**
   * *Nota:* A regra original não define igualdade. Convenção adotada: **Maior ou Igual** aplica esta regra (Definição do usuário).
   * **Ação em J:** $I$ altera a cor da borda de $J$. [cite_start]A nova borda de $J$ torna-se a cor de preenchimento de $I$[cite: 329].
     * *Exceção:* Se $I$ for uma **Linha** (sem preenchimento), usa-se a **cor complementar da borda** de $I$ (Definição do usuário).
   * **Clonagem de I:** $I$ é clonado.
     * [cite_start]O clone intercâmbia as cores de borda e preenchimento de $I$ original[cite: 330].
     * [cite_start]O clone recebe um novo ID único[cite: 456].
   * **Retorno ao Chão:**
     * $I$ (original) e $J$ (modificado) voltam ao chão.
     * [cite_start]O clone de $I$ volta ao chão **após** $I$ e $J$[cite: 331].

### Cenário 3: Número Ímpar de Elementos na Arena
* Se houver um número ímpar de elementos na arena no momento do `calc`, o último elemento (sem par) não sofre interação e **volta para o chão** (Definição do usuário).